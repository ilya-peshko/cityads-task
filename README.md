## Тестовое задание для Backend Developer (PHP 7+, Symfony, MySQL)

### Задача:
___
Необходимо реализовать HTTP сервис (JSON API) для предоставления офферов по ГЕО. Сервис должен получать данные из внешнего источника, преобразовывать их в собственные модели и сохранять в базе данных. Все API-методы сервиса должны работать с данными из БД.

#### API:

1. **GET `/offers/{geo}`**
   Принимает на вход код ГЕО и возвращает список офферов.
    - Поддержка пагинации (по умолчанию 5 элементов, максимум 20).
    - Ответ должен содержать:
        - Список офферов.
        - Общее количество офферов.
        - Дополнительные данные по усмотрению разработчика.
    - Если для запрашиваемого ГЕО нет офферов, возвращать соответствующий HTTP-код и сообщение о том, что оно не поддерживается.

2. **GET `/geo-stats`**  
   Возвращает список всех ГЕО с количеством офферов.

#### Источник данных:
Использовать API:  
`https://cityads.com/api/rest/webmaster/v2/offers/list`  
([Документация](https://cityads.com/publisher/api/description))
- Исключить офферы с гео `"Весь мир"` (код `Wrld`).
- Использовать только пагинацию.
- Сохранять в БД следующие поля:
    - `name`
    - `offer_currency.name`
    - `approval_time`
    - `site_url`
    - `logo`
    - `geo`
        - `code`
        - `name`
- Добавить вычисляемое поле `rating` с формулой:
  ```
  rating = stat.ecpl * coeff1 * coeff2
  ```
  Если коэффициенты равны 0, они не должны учитываться.  
  Вычисление коэффициентов:
  ```
  coeff1 = 10 * (1 - approval_time / 90)
  coeff2 = 100 * (1 - payment_time / 90)
  ```

#### Алгоритм обновления данных:
- При запуске приложения выполнить первоначальную загрузку данных из внешнего источника.
- Загружать данные постранично, маппить в модели и сохранять в БД.

### Технические требования:
- **Язык:** PHP 7+
- **Фреймворк:** Symfony
- **База данных:** MySQL

### Дополнительные задачи:
- Результаты API `/offers/{geo}` отсортированы по убыванию рейтинга.
- Подготовить OpenAPI-спецификацию.
- Покрыть код тестами (PHPUnit).
- Опубликовать решение в виде Docker-образа.
- Реализовать обработку ошибок API.
- Оптимизировать работу с БД (например, используя batch-обновления).
- **Реализовать API-метод `POST /sync-offers` для запуска синхронизации с внешним источником.**
    - Повторный вызов метода при незавершенной синхронизации должен блокироваться и возвращать ошибку с сообщением о повторном запуске.


### Реализованно:
- Команда для сбора данных с источника;
- Все 3 эндпоинта (`GET /api/v1/offers/{geoCode}`, `GET /api/v1/offers/stats/geo-stats`, `POST /api/v1/offers/sync-offers`);
- Результаты `GET /api/v1/offers/{geoCode}` отсортированы по убыванию;
- Сууупер с натягом обрабатываю ошибки API;
- Описана OpenAPI-спецификация для реализованных методов (`doc/http/v1.yaml`) и сгенерен html документ с визуализацией спецификации (`doc/http/v1.html`). Завести swagger не успел.

### Запуск
- `docker compose up -d --build` - собрать проект;
- `docker compose exec php composer install` - установить зависимости;
- `docker compose exec php php bin/console d:mi:mi` - выполнить миграции;
- `docker compose exec php php bin/console app:offer:sync-source` - запустить команду сбора данных с источника или постучаться на эндпоинт (`POST localhost:30001/api/v1/offers/sync-offers`).

Запуск пока без makefile или docker-entrypoint, придется потерпеть...
